/*! Imagetree - v0.1.0 - 2018-05-21
* https://github.com/liuxc/imageTree
* Copyright (c) 2018 liuxc; Licensed zrender */
!function(a){function b(a,b,c,d){this.dom=a,this.pre_level_height=50,this.zr=null,this.animation=!1,"undefined"!=typeof c&&null!=c&&(this.animation=!0),this.draggable=!1,"undefined"!=typeof d&&null!=d&&(this.draggable=!0),this.show_text=null,"undefined"!=typeof b&&null!=b&&(this.show_text=b)}b.prototype={init:function(){this.zr=a.init(this.dom,{renderer:"svg"}),this.width=this.zr.getWidth(),this.height=this.zr.getHeight()},reload:function(a){null!=this.zr&&(this.zr.clear(),this.zr=null),this.render(a)},render:function(b,c,d,e,f,g){var h=this;null==this.zr&&this.init();var i=b.length;("undefined"==typeof e||null==e)&&(e=this.width),("undefined"==typeof f||null==f)&&(f=1),("undefined"==typeof d||null==d)&&(d=0),"undefined"==typeof g||null==g?g=0:g+=this.pre_level_height;for(var j="undefined"!=typeof c&&null!==c,k=e/i,l=0;i>l;l++){var m=b[l],n=m.hasOwnProperty("childrens"),o=d+k*l+k/2-m.width/2,p=g+m.height/2,q=new a.Image({position:[o,p],style:{image:m.img_src,width:m.width,height:m.height},cursor:"pointer",draggable:this.draggable,zlevel:2});this.zr.add(q);var r=m.data,s="";for(var t in r)s+=t+" = "+r[t]+"\n";var u=o+m.width+10,v=p+10,w=150;n||(u=o-w/2,v=p+m.height/2+10);var x=new a.Text({position:[u,v],style:{text:s,width:w,textFill:"#922889",textFont:"12px Microsoft Yahei",textLineHeight:18,rich:{a:{textLineHeight:18}},truncate:{outerWidth:w,ellipsis:"..."}},zlevel:4,draggable:!0}).on("mouseover",function(){this.attr("style",{textFill:"green",truncate:{}})}).on("mouseout",function(){this.attr("style",{textFill:"#922889",truncate:{outerWidth:w,ellipsis:"..."}})}).on("click",function(){null!==h.show_text&&(h.show_text.innerHTML=this.style.text)});if(this.zr.add(x),j){var y=new a.Line({shape:{x1:c.position[0]+c.style.width/2,y1:c.position[1]+c.style.height/2,x2:q.position[0]+q.style.width/2,y2:q.position[1]+q.style.height/2},style:{fill:null,stroke:"#4965b0",lineWidth:2},zlevel:1});if(this.zr.add(y),this.animation){var z=new a.Circle({position:[y.shape.x1,y.shape.y1],shape:{r:2},style:{fill:"#4965b0",stroke:"#4965b0",lineWidth:1,shadowBlur:10,shadowColor:"#4965b0"},zlevel:3,draggable:!0});this.zr.add(z),this.zr.addHover(z,{fill:"yellow",lineWidth:1,shadowBlur:50,shadowColor:"green",stroke:"green",opacity:1}),this.zr.refresh(),function(a,b){b.animate("",!0).when(3e3,{position:[a.shape.x2,a.shape.y2]}).start()}(y,z)}!function(a,b,c){a.on("mousemove",function(){c.attr("shape",{x1:a.position[0]+a.style.width/2,y1:a.position[1]+a.style.height/2})}),b.on("mousemove",function(){c.attr("shape",{x2:b.position[0]+b.style.width/2,y2:b.position[1]+b.style.height/2})})}(c,q,y)}m.hasOwnProperty("childrens")&&this.render(m.childrens,q,d+k*l,k,f+1,g+m.height)}}},window.imageTree=b}(zrender);